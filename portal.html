<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Acad√©mico | Plataforma Educativa</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --brand-color: #0047AB;
            --brand-hover: #003580;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        
        .hero-overlay {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.5));
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .text-brand {
            color: var(--brand-color);
        }
        
        .bg-brand {
            background-color: var(--brand-color);
        }
        
        .border-brand {
            border-color: var(--brand-color);
        }
        
        .hover\:bg-brand-hover:hover {
            background-color: var(--brand-hover);
        }
        
        .badge-brand {
            background-color: var(--brand-color);
            color: white;
        }
        
        .btn-brand {
            background-color: var(--brand-color);
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-brand:hover {
            background-color: var(--brand-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 71, 171, 0.2);
        }
        
        .sticky-nav {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        }
        
        .menu-link {
            position: relative;
        }
        
        .menu-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: var(--brand-color);
            transition: width 0.3s ease;
        }
        
        .menu-link:hover::after {
            width: 100%;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--brand-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Top Bar (Redes Sociales) -->
    <div class="bg-gray-900 text-white py-2 hidden md:block">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-tiktok"></i>
                    </a>
                    <a href="#" class="text-gray-300 hover:text-white transition">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="tel:+549123456789" class="text-gray-300 hover:text-white transition flex items-center space-x-2">
                        <i class="fas fa-phone-alt"></i>
                        <span id="telefono-contacto" class="text-sm">+54 9 123 456 789</span>
                    </a>
                    <a href="mailto:info@institucion.com" class="text-gray-300 hover:text-white transition flex items-center space-x-2">
                        <i class="fas fa-envelope"></i>
                        <span id="email-contacto" class="text-sm">info@institucion.com</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Header Sticky -->
    <header class="sticky top-0 z-50 sticky-nav">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <img id="logo-nav" src="https://via.placeholder.com/180x50?text=LOGO+INSTITUCI√ìN" 
                         alt="Logo" class="h-10 object-contain">
                </div>

                <!-- Desktop Menu -->
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#inicio" class="menu-link text-gray-700 font-medium hover:text-brand transition">Inicio</a>
                    <a href="#cursos" class="menu-link text-gray-700 font-medium hover:text-brand transition">Cursos</a>
                    <a href="#nosotros" class="menu-link text-gray-700 font-medium hover:text-brand transition">Nosotros</a>
                    <a href="#contacto" class="menu-link text-gray-700 font-medium hover:text-brand transition">Contacto</a>
                    <a id="btn-campus" href="#" class="btn-brand px-6 py-3 rounded-lg font-semibold hidden">
                        Campus Virtual
                    </a>
                    <a id="btn-whatsapp" href="#" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center space-x-2 transition hidden">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </a>
                </nav>

                <!-- Mobile Menu Button -->
                <button id="menu-toggle" class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="md:hidden mt-4 hidden">
                <div class="flex flex-col space-y-4">
                    <a href="#inicio" class="text-gray-700 font-medium hover:text-brand transition">Inicio</a>
                    <a href="#cursos" class="text-gray-700 font-medium hover:text-brand transition">Cursos</a>
                    <a href="#nosotros" class="text-gray-700 font-medium hover:text-brand transition">Nosotros</a>
                    <a href="#contacto" class="text-gray-700 font-medium hover:text-brand transition">Contacto</a>
                    <a id="btn-campus-mobile" href="#" class="btn-brand px-6 py-3 rounded-lg font-semibold text-center hidden">
                        Campus Virtual
                    </a>
                    <a id="btn-whatsapp-mobile" href="#" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center space-x-2 transition hidden">
                        <i class="fab fa-whatsapp"></i>
                        <span>WhatsApp</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="hero-section" class="relative bg-cover bg-center min-h-[70vh] flex items-center"
             style="background-image: url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&w=1920&q=80');">
        <div class="hero-overlay absolute inset-0"></div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="max-w-3xl animate-fade-in">
                <h1 id="hero-title" class="text-4xl md:text-6xl font-bold text-white mb-6 leading-tight">
                    Formaci√≥n Profesional en <span id="nombre-institucion" class="text-brand">[Nombre Instituci√≥n]</span>
                </h1>
                <p id="hero-description" class="text-xl text-gray-200 mb-8">
                    Educaci√≥n de excelencia con enfoque pr√°ctico y oportunidades reales de inserci√≥n laboral
                </p>
                <div class="flex flex-wrap gap-4">
                    <a href="#cursos" class="btn-brand px-8 py-4 rounded-lg font-bold text-lg">
                        Ver Cursos <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                    <a href="#contacto" class="bg-white text-gray-800 hover:bg-gray-100 px-8 py-4 rounded-lg font-bold text-lg border-2 border-white transition">
                        Contactarnos
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Cursos Grid -->
    <section id="cursos" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12 animate-fade-in">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                    Nuestros <span class="text-brand">Cursos y Programas</span>
                </h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    Formaci√≥n especializada dise√±ada para el √©xito profesional
                </p>
            </div>

            <!-- Loader -->
            <div id="loader-cursos" class="text-center py-12">
                <div class="loader mx-auto mb-4"></div>
                <p class="text-gray-500">Cargando cat√°logo de cursos...</p>
            </div>

            <!-- Cursos Grid Container -->
            <div id="cursos-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Los cursos se cargar√°n aqu√≠ din√°micamente -->
            </div>

            <!-- Mensaje sin cursos -->
            <div id="no-cursos" class="hidden text-center py-12">
                <i class="fas fa-book-open text-gray-300 text-6xl mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Pr√≥ximamente nuevos cursos</h3>
                <p class="text-gray-500">Estamos preparando contenido especializado para ti</p>
            </div>
        </div>
    </section>

    <!-- Vista Detalle Curso (Modal) -->
    <div id="modal-curso" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden overflow-y-auto">
        <div class="container mx-auto px-4 py-12 min-h-screen flex items-center">
            <div class="bg-white rounded-2xl shadow-2xl max-w-6xl mx-auto w-full animate-fade-in">
                <div class="relative">
                    <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl z-10">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <div class="grid md:grid-cols-3 gap-0">
                        <!-- Contenido del curso -->
                        <div class="md:col-span-2 p-8">
                            <div id="modal-loader" class="text-center py-12">
                                <div class="loader mx-auto mb-4"></div>
                                <p class="text-gray-500">Cargando informaci√≥n del curso...</p>
                            </div>
                            
                            <div id="modal-content" class="hidden">
                                <h2 id="modal-titulo" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                                <div id="modal-descripcion" class="text-gray-600 mb-6"></div>
                                
                                <div class="mb-8">
                                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                                        <i class="fas fa-book-open text-brand mr-2"></i>
                                        Plan de Estudios
                                    </h3>
                                    <div id="modal-temario" class="space-y-2">
                                        <!-- Temario se cargar√° aqu√≠ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Formulario de inscripci√≥n -->
                        <div class="bg-gray-900 text-white p-8 rounded-r-2xl">
                            <h3 class="text-2xl font-bold mb-2">Inscripci√≥n</h3>
                            <p class="text-gray-300 mb-6">Solicita tu vacante hoy mismo</p>
                            
                            <form id="form-inscripcion" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Nombre completo</label>
                                    <input type="text" name="nombre" required 
                                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                                    <input type="email" name="email" required 
                                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Tel√©fono</label>
                                    <input type="tel" name="telefono" required 
                                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-1">Curso de inter√©s</label>
                                    <input type="text" id="curso-interes" readonly
                                           class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-brand">
                                </div>
                                
                                <button type="submit" 
                                        class="w-full btn-brand py-4 rounded-lg font-bold text-lg mt-6">
                                    Enviar Solicitud <i class="fas fa-paper-plane ml-2"></i>
                                </button>
                                
                                <p class="text-xs text-gray-400 text-center mt-4">
                                    Al enviar, aceptas nuestros t√©rminos y condiciones
                                </p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contacto" class="bg-gray-900 text-white pt-12 pb-8">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-8 mb-8">
                <!-- Columna 1: Nosotros -->
                <div>
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-university text-brand mr-2"></i>
                        <span id="footer-nombre">Instituci√≥n</span>
                    </h3>
                    <p id="footer-descripcion" class="text-gray-300 mb-4">
                        Formaci√≥n profesional de excelencia con m√°s de 10 a√±os de experiencia
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>

                <!-- Columna 2: Enlaces r√°pidos -->
                <div>
                    <h3 class="text-xl font-bold mb-4">Enlaces R√°pidos</h3>
                    <ul class="space-y-2">
                        <li><a href="#inicio" class="text-gray-300 hover:text-white transition">Inicio</a></li>
                        <li><a href="#cursos" class="text-gray-300 hover:text-white transition">Cursos</a></li>
                        <li><a href="#modalidad" class="text-gray-300 hover:text-white transition">Modalidades</a></li>
                        <li><a href="#certificacion" class="text-gray-300 hover:text-white transition">Certificaci√≥n</a></li>
                    </ul>
                </div>

                <!-- Columna 3: Contacto -->
                <div>
                    <h3 class="text-xl font-bold mb-4">Contacto</h3>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-map-marker-alt text-brand"></i>
                            <span id="footer-direccion" class="text-gray-300">Av. Principal 123, Ciudad</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-phone text-brand"></i>
                            <span id="footer-telefono" class="text-gray-300">+54 9 123 456 789</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-envelope text-brand"></i>
                            <span id="footer-email" class="text-gray-300">info@institucion.com</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-800 pt-8 text-center">
                <p class="text-gray-400">
                    &copy; <span id="current-year"></span> 
                    <span id="footer-institucion">Nombre Instituci√≥n</span>. 
                    Todos los derechos reservados.
                </p>
                <p class="text-gray-500 text-sm mt-2">
                    Plataforma desarrollada por <a href="https://asari.com.ar" class="text-brand hover:underline">ASARI SaaS</a>
                </p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Float -->
    <a id="whatsapp-float" href="#" 
       class="fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition z-40 hidden">
        <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <script>
        // ============================================
        // CONFIGURACI√ìN SUPABASE
        // ============================================
        const SUPABASE_URL = 'https://vxggatcfrywyodovjwxj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4Z2dhdGNmcnl3eW9kb3Zqd3hqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMzM5MjgsImV4cCI6MjA4MzgwOTkyOH0.RZ9jhEASO6nCV8EnzrHQBhglP4G1nik9Z5osPXysGNg';
        const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ID de respaldo (Colbert)
        const ID_BACKUP = 'cfa8addf-9d36-41e1-83b1-6501e5178ba7';

        // Variables globales
        let instGlobal = null;
        let cursoModal = null;

        // ============================================
        // 1. INICIALIZACI√ìN ROBUSTA
        // ============================================
        async function initPortal() {
            console.log("üöÄ Portal SaaS iniciando...");
            
            // Configurar a√±o actual en footer
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            const params = new URLSearchParams(window.location.search);
            const instParam = params.get('inst');
            const courseId = params.get('id');

            try {
                let institucion = null;
                
                // Detectar si hay par√°metro de instituci√≥n
                if (instParam) {
                    // Verificar si es UUID
                    const esUUID = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(instParam);
                    
                    if (esUUID) {
                        const { data } = await db
                            .from('instituciones')
                            .select('*')
                            .eq('id', instParam)
                            .maybeSingle();
                        institucion = data;
                    } else {
                        // Buscar por sigla o slug
                        const { data } = await db
                            .from('instituciones')
                            .select('*')
                            .or(`sigla.eq.${instParam},slug.eq.${instParam}`)
                            .maybeSingle();
                        institucion = data;
                    }
                }

                // Si no se encontr√≥ instituci√≥n, usar el ID de respaldo
                if (!institucion) {
                    console.warn("‚ö†Ô∏è Usando ID de respaldo...");
                    const { data } = await db
                        .from('instituciones')
                        .select('*')
                        .eq('id', ID_BACKUP)
                        .single();
                    institucion = data;
                }

                if (!institucion) {
                    throw new Error("Instituci√≥n no encontrada");
                }

                instGlobal = institucion;
                aplicarBranding(institucion);
                
                // Si hay ID de curso, mostrar modal
                if (courseId) {
                    await cargarDetalleCurso(courseId);
                } else {
                    await cargarContenido(institucion.id);
                }

            } catch (err) {
                console.error("‚ùå Error cr√≠tico:", err);
                document.getElementById('cursos-grid').innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="text-red-500 text-6xl mb-4">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Error al cargar el portal</h3>
                        <p class="text-gray-500">Por favor, intenta nuevamente o contacta al administrador.</p>
                    </div>
                `;
            }
            
            // Inicializar eventos
            inicializarEventos();
        }

        // ============================================
        // 2. BRANDING DIN√ÅMICO (Estilo Camale√≥n)
        // ============================================
        function aplicarBranding(inst) {
            console.log("üé® Aplicando branding para:", inst.nombre);
            
            // Configurar variable CSS global
            const root = document.documentElement;
            const color = inst.color_primario || '#0047AB';
            const colorHover = inst.color_secundario || '#003580';
            
            root.style.setProperty('--brand-color', color);
            root.style.setProperty('--brand-hover', colorHover);
            
            // Logo principal
            const logoNav = document.getElementById('logo-nav');
            if (logoNav && inst.logo_url && inst.logo_url.startsWith('http')) {
                logoNav.src = inst.logo_url;
                logoNav.alt = inst.nombre;
            }
            
            // Banner Hero
            const heroSection = document.getElementById('hero-section');
            if (heroSection) {
                const bgUrl = (inst.banner_url && inst.banner_url.startsWith('http')) 
                    ? inst.banner_url 
                    : 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&w=1920&q=80';
                heroSection.style.backgroundImage = `url('${bgUrl}')`;
            }
            
            // Textos din√°micos
            document.title = `${inst.nombre} | Portal Acad√©mico`;
            
            const heroTitle = document.getElementById('hero-title');
            const nombreInstitucion = document.getElementById('nombre-institucion');
            if (heroTitle && nombreInstitucion) {
                nombreInstitucion.textContent = inst.nombre;
                nombreInstitucion.style.color = color;
            }
            
            // Contacto
            const telefonoContacto = document.getElementById('telefono-contacto');
            const emailContacto = document.getElementById('email-contacto');
            if (telefonoContacto && inst.telefono_contacto) {
                telefonoContacto.textContent = inst.telefono_contacto;
            }
            if (emailContacto && inst.email_contacto) {
                emailContacto.textContent = inst.email_contacto;
            }
            
            // Bot√≥n WhatsApp
            const whatsappBtn = document.getElementById('btn-whatsapp');
            const whatsappMobile = document.getElementById('btn-whatsapp-mobile');
            const whatsappFloat = document.getElementById('whatsapp-float');
            
            if (inst.telefono_contacto) {
                const wppNum = inst.telefono_contacto.replace(/[^0-9]/g, '');
                const mensaje = encodeURIComponent(`Hola, me interesa informaci√≥n sobre los cursos de ${inst.nombre}`);
                const wppLink = `https://wa.me/${wppNum}?text=${mensaje}`;
                
                if (whatsappBtn) {
                    whatsappBtn.href = wppLink;
                    whatsappBtn.classList.remove('hidden');
                }
                if (whatsappMobile) {
                    whatsappMobile.href = wppLink;
                    whatsappMobile.classList.remove('hidden');
                }
                if (whatsappFloat) {
                    whatsappFloat.href = wppLink;
                    whatsappFloat.classList.remove('hidden');
                }
            }
            
            // Bot√≥n Campus
            const campusBtn = document.getElementById('btn-campus');
            const campusMobile = document.getElementById('btn-campus-mobile');
            if (inst.url_campus && campusBtn && campusMobile) {
                campusBtn.href = inst.url_campus;
                campusBtn.classList.remove('hidden');
                campusMobile.href = inst.url_campus;
                campusMobile.classList.remove('hidden');
            }
            
            // Footer
            const footerNombre = document.getElementById('footer-nombre');
            const footerInstitucion = document.getElementById('footer-institucion');
            if (footerNombre) footerNombre.textContent = inst.nombre;
            if (footerInstitucion) footerInstitucion.textContent = inst.nombre;
            
            if (inst.direccion) {
                const footerDireccion = document.getElementById('footer-direccion');
                if (footerDireccion) footerDireccion.textContent = inst.direccion;
            }
        }

        // ============================================
        // 3. CARGA DE CONTENIDO (CORREGIDO)
        // ============================================
        async function cargarContenido(instId) {
            console.log("üì¶ Cargando contenido para instituci√≥n:", instId);
            
            const container = document.getElementById('cursos-grid');
            const loader = document.getElementById('loader-cursos');
            const noCursos = document.getElementById('no-cursos');
            
            try {
                // Peticiones paralelas (QUITAMOS el filtro .eq('activo', true) para que muestre todo)
                const [areasReq, cursosReq] = await Promise.all([
                    db.from('areas')
                      .select('*')
                      .eq('institution_id', instId)
                      .order('orden', { ascending: true }),
                    
                    db.from('cursos_oficiales')
                      .select('*')
                      .eq('institution_id', instId)
                      // .eq('activo', true) <--- ESTA ERA LA L√çNEA QUE OCULTABA LOS CURSOS
                ]);

                const areas = areasReq.data || [];
                const cursos = cursosReq.data || [];

                console.log(`üìä Datos recibidos: ${areas.length} √°reas, ${cursos.length} cursos`);

                // Ocultar loader
                if (loader) loader.style.display = 'none';
                
                // Verificar si hay cursos
                if (cursos.length === 0) {
                    if (noCursos) noCursos.classList.remove('hidden');
                    return;
                }

                container.innerHTML = '';
                let cursosRenderizados = 0;

                // ESTRATEGIA 1: Renderizar por √°reas (Si hay √°reas definidas)
                if (areas.length > 0) {
                    areas.forEach(area => {
                        const cursosArea = cursos.filter(c => c.area_id === area.id);
                        
                        if (cursosArea.length > 0) {
                            cursosRenderizados += cursosArea.length;
                            
                            // T√≠tulo del √°rea
                            const areaTitle = document.createElement('h3');
                            areaTitle.className = 'text-2xl font-bold text-gray-800 mt-12 mb-6 border-l-4 border-brand pl-4 uppercase col-span-full';
                            areaTitle.textContent = area.nombre;
                            container.appendChild(areaTitle);
                            
                            // Grid de cursos del √°rea
                            const grid = document.createElement('div');
                            grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8 col-span-full';
                            
                            cursosArea.forEach(curso => {
                                grid.appendChild(crearTarjetaCurso(curso));
                            });
                            
                            container.appendChild(grid);
                        }
                    });
                }
                
                // ESTRATEGIA 2: Si no hay √°reas o quedaron cursos sin asignar, mostrar todo junto
                // (Esto es un respaldo por si falla la relaci√≥n con √°reas)
                if (cursosRenderizados === 0 && cursos.length > 0) {
                    console.log("‚ö†Ô∏è Mostrando cursos sin agrupar por √°reas");
                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 col-span-full';
                    
                    cursos.forEach(curso => {
                        grid.appendChild(crearTarjetaCurso(curso));
                    });
                    
                    container.appendChild(grid);
                }
                
            } catch (err) {
                console.error("‚ùå Error cargando contenido:", err);
                if (loader) loader.style.display = 'none';
                if (noCursos) noCursos.classList.remove('hidden');
            }
        }

        // Funci√≥n auxiliar para generar el HTML de la tarjeta (para no repetir c√≥digo)
        function crearTarjetaCurso(curso) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden group border border-gray-100 card-hover';
            
            const imgUrl = curso.imagen_url || 'https://images.unsplash.com/photo-1576091160550-217358c7db81?auto=format&fit=crop&w=800&q=80';
            
            const descripcion = curso.descripcion || 'Formaci√≥n profesional con certificaci√≥n oficial.';
            const descripcionCorta = descripcion.length > 120 ? descripcion.substring(0, 120) + '...' : descripcion;
            
            card.innerHTML = `
                <div class="relative h-48 overflow-hidden">
                    <img src="${imgUrl}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" alt="${curso.nombre}" loading="lazy">
                    <div class="absolute top-4 right-4 badge-brand text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Inscripci√≥n Abierta</div>
                </div>
                <div class="p-6">
                    <h4 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2 min-h-[3.5rem]">${curso.nombre}</h4>
                    <p class="text-gray-500 text-sm mb-4 line-clamp-3">${descripcionCorta}</p>
                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-100">
                        <span class="text-xs text-gray-400 font-semibold"><i class="far fa-clock mr-1"></i> ${curso.duracion || 'Oficial'}</span>
                        <button onclick="abrirModalCurso('${curso.id}')" class="text-brand font-bold text-sm hover:underline flex items-center">
                            VER DETALLE <i class="fas fa-arrow-right ml-2 group-hover:ml-3 transition-all"></i>
                        </button>
                    </div>
                </div>
            `;
            return card;
        }

        // ============================================
        // 4. MODAL DE DETALLE DE CURSO
        // ============================================
        async function cargarDetalleCurso(cursoId) {
            const modal = document.getElementById('modal-curso');
            const modalLoader = document.getElementById('modal-loader');
            const modalContent = document.getElementById('modal-content');
            const cursoInteres = document.getElementById('curso-interes');
            
            modal.classList.remove('hidden');
            
            try {
                const { data: curso, error } = await db
                    .from('cursos_oficiales')
                    .select('*')
                    .eq('id', cursoId)
                    .single();
                
                if (error || !curso) {
                    throw new Error('Curso no encontrado');
                }
                
                cursoModal = curso;
                
                // Mostrar contenido
                modalLoader.classList.add('hidden');
                modalContent.classList.remove('hidden');
                
                // Actualizar informaci√≥n
                document.getElementById('modal-titulo').textContent = curso.nombre;
                document.getElementById('modal-descripcion').innerHTML = 
                    curso.descripcion || '<p class="text-gray-500">No hay descripci√≥n disponible.</p>';
                
                // Actualizar campo del formulario
                if (cursoInteres) {
                    cursoInteres.value = curso.nombre;
                }
                
                // Cargar temario si existe
                const temarioContainer = document.getElementById('modal-temario');
                if (temarioContainer) {
                    temarioContainer.innerHTML = '';
                    
                    if (curso.contenido && Array.isArray(curso.contenido) && curso.contenido.length > 0) {
                        curso.contenido.forEach((modulo, index) => {
                            const moduloElement = document.createElement('div');
                            moduloElement.className = 'bg-gray-50 rounded-lg p-4 flex justify-between items-center';
                            moduloElement.innerHTML = `
                                <span class="font-medium text-gray-700">
                                    M√≥dulo ${index + 1}: ${modulo.titulo || 'Sin t√≠tulo'}
                                </span>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            `;
                            temarioContainer.appendChild(moduloElement);
                        });
                    } else {
                        temarioContainer.innerHTML = `
                            <div class="text-center py-6 text-gray-500">
                                <i class="fas fa-book-open text-3xl mb-2"></i>
                                <p>Contenido program√°tico disponible al inscribirse</p>
                            </div>
                        `;
                    }
                }
                
            } catch (err) {
                console.error("‚ùå Error cargando curso:", err);
                modalLoader.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-circle text-red-500 text-4xl mb-4"></i>
                        <p class="text-red-500">Error al cargar el curso</p>
                    </div>
                `;
            }
        }

        // ============================================
        // 5. FUNCIONES AUXILIARES Y EVENTOS
        // ============================================
        function inicializarEventos() {
            // Men√∫ m√≥vil
            const menuToggle = document.getElementById('menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (menuToggle && mobileMenu) {
                menuToggle.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    const icon = menuToggle.querySelector('i');
                    if (icon.classList.contains('fa-bars')) {
                        icon.classList.replace('fa-bars', 'fa-times');
                    } else {
                        icon.classList.replace('fa-times', 'fa-bars');
                    }
                });
            }
            
            // Cerrar modal
            const closeModal = document.getElementById('close-modal');
            const modal = document.getElementById('modal-curso');
            
            if (closeModal && modal) {
                closeModal.addEventListener('click', () => {
                    modal.classList.add('hidden');
                    // Limpiar URL si ven√≠a de un curso espec√≠fico
                    if (window.location.search.includes('id=')) {
                        const url = new URL(window.location);
                        url.searchParams.delete('id');
                        window.history.replaceState({}, '', url);
                    }
                });
            }
            
            // Cerrar modal con ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                }
            });
            
            // Formulario de inscripci√≥n
            const formInscripcion = document.getElementById('form-inscripcion');
            if (formInscripcion) {
                formInscripcion.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (!instGlobal) {
                        alert('Error: No se identific√≥ la instituci√≥n');
                        return;
                    }
                    
                    const formData = new FormData(formInscripcion);
                    const btnSubmit = formInscripcion.querySelector('button[type="submit"]');
                    const originalText = btnSubmit.innerHTML;
                    
                    // Estado de carga
                    btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Enviando...';
                    btnSubmit.disabled = true;
                    
                    try {
                        const leadData = {
                            nombre: formData.get('nombre'),
                            email: formData.get('email'),
                            telefono: formData.get('telefono'),
                            curso_interes: formData.get('curso-interes') || 'Consulta General',
                            institution_id: instGlobal.id,
                            fuente: 'Portal SaaS',
                            status: 'nuevo',
                            created_at: new Date().toISOString()
                        };
                        
                        console.log('üì§ Enviando lead:', leadData);
                        
                        const { error } = await db.from('leads').insert([leadData]);
                        
                        if (error) {
                            throw new Error(`Error al guardar: ${error.message}`);
                        }
                        
                        // √âxito
                        btnSubmit.innerHTML = '<i class="fas fa-check mr-2"></i> ¬°Enviado!';
                        btnSubmit.style.backgroundColor = '#10b981';
                        
                        // Redirigir a WhatsApp si hay tel√©fono
                        setTimeout(() => {
                            if (instGlobal.telefono_contacto) {
                                const wppNum = instGlobal.telefono_contacto.replace(/[^0-9]/g, '');
                                const mensaje = encodeURIComponent(
                                    `Hola, acabo de registrarme en el portal de ${instGlobal.nombre} ` +
                                    `para el curso "${formData.get('curso-interes')}". ` +
                                    `Mi nombre es ${leadData.nombre}. Necesito informaci√≥n.`
                                );
                                window.open(`https://wa.me/${wppNum}?text=${mensaje}`, '_blank');
                            }
                        }, 1000);
                        
                        // Resetear formulario
                        setTimeout(() => {
                            formInscripcion.reset();
                            btnSubmit.innerHTML = originalText;
                            btnSubmit.style.backgroundColor = '';
                            btnSubmit.disabled = false;
                            modal.classList.add('hidden');
                        }, 3000);
                        
                    } catch (error) {
                        console.error('‚ùå Error en formulario:', error);
                        alert(`Error: ${error.message}`);
                        btnSubmit.innerHTML = originalText;
                        btnSubmit.disabled = false;
                    }
                });
            }
            
            // Smooth scroll para enlaces internos
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const href = this.getAttribute('href');
                    if (href === '#') return;
                    
                    e.preventDefault();
                    const target = document.querySelector(href);
                    if (target) {
                        // Cerrar men√∫ m√≥vil si est√° abierto
                        if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                            mobileMenu.classList.add('hidden');
                            const icon = menuToggle.querySelector('i');
                            if (icon.classList.contains('fa-times')) {
                                icon.classList.replace('fa-times', 'fa-bars');
                            }
                        }
                        
                        window.scrollTo({
                            top: target.offsetTop - 80,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }

        // Funci√≥n global para abrir modal desde botones
        window.abrirModalCurso = function(cursoId) {
            // Actualizar URL con el ID del curso
            const url = new URL(window.location);
            url.searchParams.set('id', cursoId);
            window.history.pushState({}, '', url);
            
            cargarDetalleCurso(cursoId);
        };

        // ============================================
        // INICIAR APLICACI√ìN
        // ============================================
        document.addEventListener('DOMContentLoaded', initPortal);
        
        // Manejar navegaci√≥n atr√°s/adelante
        window.addEventListener('popstate', () => {
            const params = new URLSearchParams(window.location.search);
            const courseId = params.get('id');
            const modal = document.getElementById('modal-curso');
            
            if (courseId) {
                if (modal && modal.classList.contains('hidden')) {
                    cargarDetalleCurso(courseId);
                }
            } else {
                if (modal && !modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                }
            }
        });
    </script>
</body>
</html>
