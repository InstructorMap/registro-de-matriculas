<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Alta de Alumnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3>üéì Alta de Alumno (ASARI)</h3>
        </div>
        <div class="card-body">
            <form id="formAlta">
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">DNI (Usuario)</label>
                        <input type="text" id="dni" class="form-control" placeholder="Ej: 33656107" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="alumno@email.com">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="nombre" class="form-control" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Apellido</label>
                        <input type="text" id="apellido" class="form-control" required>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Curso</label>
                        <select id="curso" class="form-select">
                            <option value="Param√©dico Profesional 2025">Param√©dico Profesional 2025</option>
                            <option value="Instructor de RCP">Instructor de RCP</option>
                            <option value="Socorrismo Urbano">Socorrismo Urbano</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Estado</label>
                        <select id="estado" class="form-select">
                            <option value="ACTIVO">ACTIVO</option>
                            <option value="DEUDOR">DEUDOR</option>
                        </select>
                    </div>
                     <div class="col-md-3">
                        <label class="form-label">Fecha Inicio</label>
                        <input type="date" id="fecha" class="form-control">
                    </div>
                </div>

                <button type="submit" class="btn btn-success w-100 p-3">üíæ GUARDAR ALUMNO</button>
            </form>

            <div id="mensaje" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    // ---------------------------------------------------------
    // TUS DATOS REALES (Ya configurados)
    // ---------------------------------------------------------
    const PROJECT_URL = 'https://vxggatcfrywyodovjwxj.supabase.co';
    const PUBLIC_KEY  = 'sb_publishable_Zkc12UR5e4tz7cjZhoczyQ_cUxX_x5r';
    // ---------------------------------------------------------

    // Inicializamos el cliente
    const supabase = supabase.createClient(PROJECT_URL, PUBLIC_KEY);

    document.getElementById('formAlta').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const msgDiv = document.getElementById('mensaje');
        msgDiv.innerHTML = '<div class="alert alert-info">‚è≥ Procesando...</div>';

        // Recolectamos datos
        const datos = {
            dni_alumno: document.getElementById('dni').value,
            nombre: document.getElementById('nombre').value,
            apellido: document.getElementById('apellido').value,
            email: document.getElementById('email').value,
            curso: document.getElementById('curso').value,
            estado: document.getElementById('estado').value,
            fecha_inicio: document.getElementById('fecha').value || new Date().toISOString().split('T')[0]
        };

        // Enviamos a la base de datos
        // NOTA: Usamos .select() al final para confirmar que devolvi√≥ datos
        const { data, error } = await supabase
            .from('matriculas')
            .insert([datos])
            .select();

        if (error) {
            console.error('Error detallado:', error);
            msgDiv.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${error.message}</div>`;
        } else {
            console.log('Alumno guardado:', data);
            msgDiv.innerHTML = `<div class="alert alert-success">‚úÖ ¬°√âXITO! Alumno ${datos.apellido} cargado correctamente.</div>`;
            document.getElementById('formAlta').reset();
        }
    });
</script>

</body>
</html>
