<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - ASARI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3>üéì Alta de Alumno (ASARI)</h3>
        </div>
        <div class="card-body">
            <div id="formulario">
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">DNI (Usuario)</label>
                        <input type="text" id="dni" class="form-control" placeholder="Ej: 33656107">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="alumno@email.com">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="nombre" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Apellido</label>
                        <input type="text" id="apellido" class="form-control">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Curso</label>
                        <select id="curso" class="form-select">
                            <option value="Param√©dico Profesional 2025">Param√©dico Profesional 2025</option>
                            <option value="Instructor de RCP">Instructor de RCP</option>
                            <option value="Socorrismo Urbano">Socorrismo Urbano</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Estado</label>
                        <select id="estado" class="form-select">
                            <option value="ACTIVO">ACTIVO</option>
                            <option value="DEUDOR">DEUDOR</option>
                        </select>
                    </div>
                     <div class="col-md-3">
                        <label class="form-label">Fecha Inicio</label>
                        <input type="date" id="fecha" class="form-control">
                    </div>
                </div>

                <button onclick="guardarAlumno()" id="btnGuardar" class="btn btn-success w-100 p-3">üíæ GUARDAR ALUMNO</button>
            </div>

            <div id="mensaje" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
    // ---------------------------------------------------------
    // TUS DATOS (Confirmados por la prueba exitosa)
    // ---------------------------------------------------------
    const PROJECT_URL = 'https://vxggatcfrywyodovjwxj.supabase.co';
    const PUBLIC_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4Z2dhdGNmcnl3eW9kb3Zqd3hqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMzM5MjgsImV4cCI6MjA4MzgwOTkyOH0.RZ9jhEASO6nCV8EnzrHQBhglP4G1nik9Z5osPXysGNg';
    // ---------------------------------------------------------

    // Inicializamos el cliente
    const db = supabase.createClient(PROJECT_URL, PUBLIC_KEY);

    async function guardarAlumno() {
        // 1. Bloquear bot√≥n para evitar doble click
        const btn = document.getElementById('btnGuardar');
        const msgDiv = document.getElementById('mensaje');
        
        btn.disabled = true;
        btn.innerText = "‚è≥ Guardando...";
        msgDiv.innerHTML = '';

        // 2. Recolectar datos
        const dniVal = document.getElementById('dni').value;
        const nombreVal = document.getElementById('nombre').value;
        const apellidoVal = document.getElementById('apellido').value;

        // Validaci√≥n b√°sica
        if(!dniVal || !nombreVal || !apellidoVal) {
            msgDiv.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Por favor completa DNI, Nombre y Apellido.</div>';
            btn.disabled = false;
            btn.innerText = "üíæ GUARDAR ALUMNO";
            return;
        }

        const datos = {
            dni_alumno: dniVal,
            nombre: nombreVal,
            apellido: apellidoVal,
            email: document.getElementById('email').value,
            curso: document.getElementById('curso').value,
            estado: document.getElementById('estado').value,
            fecha_inicio: document.getElementById('fecha').value || new Date().toISOString().split('T')[0]
        };

        // 3. Enviar a Supabase (Igual que en el test)
        const { data, error } = await db
            .from('matriculas')
            .insert([datos])
            .select();

        // 4. Mostrar resultado
        if (error) {
            console.error('Error:', error);
            msgDiv.innerHTML = `<div class="alert alert-danger">‚ùå Error: ${error.message}</div>`;
        } else {
            console.log('Guardado:', data);
            msgDiv.innerHTML = `<div class="alert alert-success">‚úÖ ¬°√âXITO! Alumno <b>${datos.apellido}</b> guardado correctamente.</div>`;
            
            // Limpiar campos
            document.getElementById('dni').value = '';
            document.getElementById('nombre').value = '';
            document.getElementById('apellido').value = '';
            document.getElementById('email').value = '';
        }

        // Restaurar bot√≥n
        btn.disabled = false;
        btn.innerText = "üíæ GUARDAR ALUMNO";
    }
</script>

</body>
</html>
